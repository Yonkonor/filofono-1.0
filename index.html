<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Mantener el mismo head y estilos -->
</head>
<body>
    <!-- Mantener misma estructura HTML -->

    <script>
        // ... Configuraciones anteriores ...

        function calculateGValue() {
            // Usar aceleración REAL sin gravedad
            return Math.hypot(
                acceleration.x,
                acceleration.y,
                acceleration.z
            ) / 9.81; // Convertir a g
        }

        async function toggleSound() {
            if (!isPlaying) {
                try {
                    if (typeof DeviceMotionEvent.requestPermission === 'function') {
                        const permission = await DeviceMotionEvent.requestPermission();
                        if (permission !== 'granted') return;
                    }

                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    startTime = Date.now();
                    lastUpdate = startTime;
                    createViolinSound();
                    
                    // CAMBIAR A acceleration en lugar de accelerationIncludingGravity
                    window.addEventListener('devicemotion', (e) => {
                        acceleration = e.acceleration; // ¡Este es el cambio clave!
                        updateSound(Date.now());
                    });

                    // ... resto del código ...
                }
                // ... manejo de errores ...
            }
        }

        function updateSound(timestamp) {
            const currentG = calculateGValue();
            
            // Umbral de silencio para eliminar ruido mínimo
            const silenceThreshold = 0.1;
            if (currentG < silenceThreshold) {
                gainNode.gain.setTargetAtTime(0, audioContext.currentTime, 0.1);
                gValueDisplay.textContent = '0.00 g';
                return;
            }

            // Mapeo no lineal para mejor respuesta
            const intensity = Math.min(Math.pow(currentG, 1.5), 2);
            
            // ... resto del código de actualización ...
        }

        // ... resto de las funciones ...
    </script>
</body>
</html>
